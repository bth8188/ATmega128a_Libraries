/*
 * graphic.c
 *
 * Created: 2019-09-02 오후 8:32:10
 *  Author: kccistc
 */ 

#include "graphic.h"

char H[]={0x7F, 0x08, 0x08, 0x08, 0x7F, 0x00};
char E[]={0x7F, 0x49, 0x49, 0x49, 0x41, 0x00};
char L[]={0x7F, 0x40, 0x40, 0x40, 0x40, 0x00};
char O[]={0x3E, 0x41, 0x41, 0x41, 0x3E, 0x00};

char W[]={0x3F, 0x40, 0x38, 0x40, 0x3F, 0x00};
char R[]={0x7F, 0x09, 0x19, 0x29, 0x46, 0x00};
char D[]={0x7F, 0x41, 0x41, 0x22, 0x1C, 0x00};
	
char pk[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00, 0xfc, 0x03, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xfc, 0x03, 0x00, 0x00, 0x02, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x20, 0x00, 0x01, 0x00, 0x10, 0x00, 0x03, 0x00, 0x08, 0x80, 0x02, 0x80, 0x08, 0x84, 0x0e, 0x80, 0x04, 0x82, 0x1a, 0x80, 0x04, 0x42, 0x12, 0x80, 0x04, 0x41, 0x22, 0x80, 0x04, 0x61, 0x21, 0x80, 0x04, 0x21, 0x31, 0x00, 0x04, 0x21, 0x31, 0x10};
char pe2[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x04, 0x08, 0x00, 0x00, 0x0a, 0x10, 0x00, 0x00, 0x12, 0x10, 0x00, 0x00, 0x11, 0x10, 0x00, 0x00, 0x11, 0x10, 0x00, 0x00, 0x20, 0x10, 0x00, 0x00, 0x24, 0x10, 0x00, 0x00, 0x44, 0x10, 0x00, 0x00, 0x44, 0x10, 0x00, 0x00, 0x48, 0x10, 0x00, 0x00, 0x48, 0x18, 0x00, 0x00, 0x89, 0x0c, 0x00, 0x00, 0x89, 0x04, 0x00, 0x00};
char pe3[] = {0x08, 0x21, 0x7d, 0x08, 0x08, 0x32, 0x4d, 0x04, 0x30, 0x94, 0x4c, 0x02, 0xc8, 0x57, 0xf8, 0x03, 0x04, 0x4a, 0xf8, 0x00, 0x04, 0xf2, 0x0f, 0x00, 0x04, 0x92, 0x58, 0x00, 0x04, 0x91, 0x98, 0x00, 0x0c, 0x89, 0x90, 0x00, 0x18, 0xc9, 0x90, 0x80, 0x30, 0x69, 0x9c, 0x40, 0xe0, 0x27, 0x9e, 0x60, 0x00, 0x27, 0x9e, 0x21, 0x00, 0x26, 0x12, 0x31, 0x00, 0x24, 0x12, 0x17, 0x00, 0x38, 0x1e, 0x9d, 0x00, 0xe0, 0xff, 0x88, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char pe4[] = {0x89, 0x05, 0x00, 0x00, 0x89, 0x05, 0x00, 0x00, 0x89, 0x05, 0x00, 0x00, 0x89, 0x05, 0x00, 0x00, 0x89, 0x06, 0x00, 0x00, 0xc9, 0x02, 0x00, 0x00, 0x49, 0x03, 0x00, 0x00, 0x49, 0x03, 0x00, 0x00, 0x49, 0x01, 0x00, 0x00, 0x64, 0x01, 0x00, 0x00, 0xb4, 0x00, 0x00, 0x00, 0x92, 0x00, 0x00, 0x00, 0x91, 0x00, 0x00, 0x00, 0xd9, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

void LCD_E_Falling()
{
	GP_LCD_CMD_PORT |= (1 << GP_LCD_ECLK);
	_delay_us(100);
	GP_LCD_CMD_PORT &= ~(1 << GP_LCD_ECLK);
}

void LCD_CMD(uint8_t _cs, uint8_t _command)
{
	GP_LCD_CMD_PORT = 0x00 | (1 << GP_LCD_RES);
	
#if (GLCD_CS_Type == CS_Low_Active)
	GP_LCD_CMD_PORT = 0x00 | (1 << GP_LCD_RES) | CS_Low_Active;
	if(_cs == 0) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS1) & ~(1 << GP_LCD_CS2);
	
#elif (GLCD_CS_Type == CS_High_Active)
	if(_cs == 0) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1) | (1 << GP_LCD_CS2);
#endif

	GP_LCD_Data_PORT |= _command;
	LCD_E_Falling();
}

void LCD_RST(uint8_t _cs)
{
	GP_LCD_CMD_PORT = 0x00 | (1 << GP_LCD_RES);
	
	#if (GLCD_CS_Type == CS_Low_Active)
	GP_LCD_CMD_PORT = 0x00 | (1 << GP_LCD_RES) | CS_Low_Active;
	if(_cs == 0) GP_LCD_CMD_PORT &= ~(1 <<GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS1) & ~(1 << GP_LCD_CS2);
	else if(_cs == 3);
	
	#elif (GLCD_CS_Type == CS_High_Active)
	if(_cs == 0) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1) | (1 << GP_LCD_CS2);
	else if(_cs == 3);
	#endif
	
	GP_LCD_CMD_PORT = 0x00;
	LCD_E_Falling();
}

void LCD_Write_Data(uint8_t _cs ,uint8_t dot)
{
	GP_LCD_CMD_PORT = 0x00 | (1 << GP_LCD_DI) | (1 << GP_LCD_RES);
	
	#if (GLCD_CS_Type == CS_Low_Active)
	if(_cs == 0) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT &= ~(1 << GP_LCD_CS1) & ~(1 << GP_LCD_CS2);
	
	#elif (GLCD_CS_Type == CS_High_Active)
	if(_cs == 0) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1);
	else if(_cs == 1) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS2);
	else if(_cs == 2) GP_LCD_CMD_PORT |= (1 << GP_LCD_CS1) | (1 << GP_LCD_CS2);
	#endif

	GP_LCD_Data_PORT = dot;
	LCD_E_Falling();
}

void LCD_Display_ON(uint8_t _cs)
{
	LCD_CMD(_cs, CMD_On);
}

void LCD_Display_Off(uint8_t _cs)
{
	LCD_CMD(_cs, CMD_Off);
}

void LCD_Set_Start(uint8_t _side, uint8_t _start)
{
	LCD_CMD(_side, CMD_Set_Sline | _start);
}

void LCD_Yaddr(uint8_t _side ,uint8_t y)
{
	LCD_CMD(_side, CMD_Set_Yaddr | y);
}

void LCD_Xpage(uint8_t _side , uint8_t page)
{
	if(page == 0) LCD_CMD(_side, CMD_Set_Page | 7);
	else LCD_CMD(_side, CMD_Set_Page | (page-1));
}

void LCD_Set_Cursor(uint8_t _side ,uint8_t y, uint8_t page)
{
	LCD_Xpage(_side, page);
	LCD_Write_Data(_side, 0);
	LCD_Yaddr(_side, y);
	//else LCD_Yaddr(_side, 64);
}

void LCD_Write_String(uint8_t _side, char *_str)
{
	int i = 0;
	for(int i = 0; _str[i]; i++)
	{	
		LCD_Write_Data(_side, _str[i]);
	}
}

int LCD_Str_length(char *_str)
{
	int i = 0;
	for(i = 0; _str[i]; i++)
	return i;
}

// void LCD_YXpage_Write_String(uint8_t _side, uint8_t y, uint8_t x, char *_str)
// {
// 	LCD_Set_Cursor(_side, y, x);
// 	if(y + LCD_Str_length(_str) < 64) for(int i = 0; _str[i]; i++) LCD_Write_Data(_side, _str[i]);
// 	else
// 	{
// 		if(_side == Left_side)
// 		{
// 			for(int i = 0; _str[i]; i++)
// 			{
// 				if(y + i)
// 				else if(y + i > 64) LCD_Write_Data(Right_side, _str[i]);
// 				else LCD_Write_Data(Left_side, _str[i]);
// 			}
// 		}
// 		else
// 		{
// 			
// 		}
// 	}
// }

void LCD_Init()
{
	GP_LCD_Data_DDR |= 0xff;
	GP_LCD_CMD_DDR |= 0xff;
	
	LCD_Display_ON(Left_side);
	LCD_Display_ON(Right_side);
	LCD_Set_Start(Left_side, 0);
	for(int i= 0; i < 9; i++)
	{
		LCD_CMD(Left_side, CMD_Set_Page | i);
		for(int j = 0; j < 64; j++) LCD_Write_Data(Left_side, 0);
	}
	LCD_CMD(Left_side, CMD_Set_Yaddr | 0);
	LCD_Set_Start(Right_side, 0);
	for(int i= 0; i < 9; i++)
	{
		LCD_CMD(Right_side, CMD_Set_Page | i);
		for(int j = 0; j < 64; j++) LCD_Write_Data(Right_side, 0);
	}
	LCD_CMD(Right_side, CMD_Set_Yaddr | 0);
}

void LCD_Ypage_Write_Data(uint8_t _side ,int y, uint8_t page, uint8_t dot)
{
	LCD_Set_Cursor(_side, y, page);
	LCD_Write_Data(_side, dot);
}

void test_l()
{
	int i = 0, y = 0, x = 0;
	GP_LCD_Data_DDR |= 0xff;
	GP_LCD_CMD_DDR |= 0xff;
	LCD_Init();
	while(1)
	{
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, H[i]);
// 			_delay_ms(100);
// 		}
// 		LCD_CMD(Left_side, CMD_Set_Page | x++);
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, E[i]);
// 			_delay_ms(100);
// 		}
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, L[i]);
// 			_delay_ms(100);
// 		}
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, O[i]);
// 			_delay_ms(100);
// 		}
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, W[i]);
// 			_delay_ms(100);
// 		}
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, R[i]);
// 			_delay_ms(100);
// 		}
// 		for(int i = 0; i <6; i++)
// 		{
// 			LCD_Write_Data(Left_side, D[i]);
// 			_delay_ms(100);
// 		}
		for(int i = 0; i < 4; i++)
		{
				LCD_Set_Cursor(Left_side, 32, i+1);
			for(int j = 0; j < 32; j++)
			{
				LCD_Write_Data(Left_side, pk[(4*j)+i]);
			}
		}
		for(int i = 0; i < 4; i++)
		{
			LCD_Set_Cursor(Right_side, 0, i+1);
			for(int j = 0; j < 32; j++)
			{
				LCD_Write_Data(Right_side, pe3[4*j+i]);
			}
		}
		for(int i = 0; i < 4; i++)
		{
			LCD_Set_Cursor(Left_side, 32, i+5);
			for(int j = 0; j < 32; j++)
			{
				LCD_Write_Data(Left_side, pe2[4*j+i]);
			}
		}
		for(int i = 0; i < 4; i++)
		{
			LCD_Set_Cursor(Right_side, 0, i+5);
			for(int j = 0; j < 32; j++)
			{
				LCD_Write_Data(Right_side, pe4[4*j+i]);
			}
		}
	}
}